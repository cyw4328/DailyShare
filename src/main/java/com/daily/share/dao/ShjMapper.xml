<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.daily.share.dao.ShjDAO">


	<!-- 리스트 관련 쿼리 -->
	<select id="list" resultType="com.daily.share.dto.ShjDTO">
		SELECT mem_id, mem_name, mem_email, mem_phone, mem_out, mem_san FROM members ORDER BY mem_id DESC LIMIT #{param1} OFFSET #{param2}
	</select>
	
	<select id="allCount" resultType="int">
		SELECT COUNT (mem_id) FROM members
	</select>

	
	
	<!-- 검색 쿼리 / 공백 입력 처리 안했으니 주의할것!! -->
	<select id="getSearchList" parameterType="com.daily.share.dto.ShjDTO" resultType="com.daily.share.dto.ShjDTO">
		SELECT mem_id, mem_name, mem_email, mem_phone, mem_out, mem_san FROM members 
		
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="keyword != null">
				<if test="SearchType == 'all'">
					AND mem_id OR mem_name LIKE CONCAT ('%',#{keyword},'%')
				</if>
				<if test="SearchType == 'mem_id'">
					AND mem_id LIKE CONCAT ('%',#{keyword},'%')
				</if>
				<if test="SearchType == 'mem_name'">
					AND mem_name LIKE CONCAT ('%',#{keyword},'%')
				</if>
			</if>
		</trim>
	</select>
	
	
	<!-- 게시글 추천시 insert -->
	<insert id="insertLike">
		INSERT INTO likes (board_num, mem_id) VALUES (#{board_num}, #{mem_id})
	</insert>
	
	<!-- 한번 더 눌러서 삭제 -->
	<delete id="deleteLike">
		DELETE FROM likes where board_num = #{board_num} AND mem_id = #{mem_id}
	</delete>
	
	<!-- 좋아요 유무 확인 -->
	<select id="LikeCheck" parameterType="com.daily.share.dto.ShjDTO" resultType="com.daily.share.dto.ShjDTO">
		SELECT count(*) FROM likes WHERE board_num = {param2} AND mem_id = {param3}
	</select>
	
	
</mapper>